# Easter Data Essay - Silvan Albin# 

# loading and preparing the dataset
data = readRDS("Data_Essay_Account.RDS")
View(data)
library(foreign)
library(ggplot2)
library(stargazer)
library(psych)
library(dplyr)
library(VIF)
library(car)
library(gridExtra)

########################################################################################################

## 1. Exercise 
# creating a new variable
data$divote = data$vote - data$pvote # creating new variable "divote" (dependent variable)
data = na.omit(data) # exclude all NAs from our data set

# Descriptive Statistics

# describe independent variable unemployment
## summary of the variable
attach(data)
descriptive = describeBy(unem, ctrynam, skew = F)
descrUnem<-do.call("rbind",descriptive)
df2latex(descrUnem)

summary(unem)

## histogram
ggplot(data, aes(x = unem, colour = ctrynam))+
  geom_histogram(binwidth = 0.7, fill="white") + facet_wrap(~ctrynam) +
  labs(title = "Distribution of Unemployment", x="Unemployment", y="Observations", colour="Countries")

## boxplot
boxplot(unem ~ ctrynam, data=data, ylab="Unemployment")

# describe independent variable inflation
## summary of the variable
summary(infl)

descriptive = describeBy(infl, ctrynam, skew = F)
descrInfl<-do.call("rbind",descriptive)
df2latex(descrInfl)

## histogram
ggplot(data, aes(x = infl, colour = ctrynam))+
  geom_histogram(binwidth = 0.2, fill="white") + facet_wrap(~ctrynam) +
  labs(title = "Distribution of Inflation", x="Inflation", y="Observations", colour="Countries")

 
# describe independent variable economic growth
## summary of the variabel
summary(growth)
descriptive = describeBy(growth, ctrynam, skew = F)
descrGrowth<-do.call("rbind",descriptive)
df2latex(descrGrowth)

## histogram
ggplot(data, aes(x = growth, colour = ctrynam))+
  geom_histogram(binwidth = 0.7, fill="white") + facet_wrap(~ctrynam) +
  labs(title = "Distribution of Growth", x="Growth", y="Observations", colour="Countries")

## density plot of economic growth and unemployment
growth = ggplot(data, aes(x=growth))+
  geom_density()+
  geom_vline(data=data, aes(xintercept=data$growth[9]), linetype="dashed", size=0.5, color="red")+
  geom_text(aes(x=data$growth[9], y=0.21),label="mean", color="red")+
  labs(x="Economic growth")

unem = ggplot(data, aes(x=unem))+
  geom_density()+
  geom_vline(data=data, aes(xintercept=data$unem[9]), linetype="dashed", size=0.5, color="red")+
  geom_text(aes(x=data$unem[9], y=0.1),label="mean", color="red")+
  labs(x="Unemployment")

independent <- grid.arrange(growth, unem, ncol=2)

# display dummy variable of left-right party affiliation
## histogram 
ggplot(data, aes(x = ctrright, colour = ctrynam)) +
  geom_histogram(binwidth = 1, fill="white") + facet_wrap(~ctrynam) +
  labs(title = "Distribution of Partyaffiliation (left-right)", x="Left vs. Right", y="Observations", colour="Countries")

# describe dependent variable "divote"
## summary of the variable
summary(divote)
descriptive = describeBy(divote, ctrynam, skew = F)
descrVote<-do.call("rbind",descriptive)
df2latex(descrVote)

########################################################################################################

# Hypothesis 1

attach(data)

data = readRDS("Data_Essay_Account.RDS")
data$divote = data$vote - data$pvote
data = na.omit(data)

attach(data)

# run different regressions
Reg1 = lm(divote ~ infl)
Reg2 = lm(divote ~ unem)
Reg3 = lm(divote ~ growth)
Reg4 = lm(divote ~ growth + unem)
Reg5 = lm(divote ~ growth + infl)
Reg6 = lm(divote ~ unem + infl)
Reg7 = lm(divote ~ unem + growth + infl)
Reg8 = lm(divote ~ unem + growth + infl + mingov + earlyelec) # including control variables

stargazer(Reg1, Reg2, Reg3, Reg7, Reg8, type = "latex")


# Scatter Plots
## unemployment as independent variable and divote as dependent variable
ggplot(data, aes(x=unem, y=divote)) +
  geom_point(color = "darkslategrey") +
  labs(title = "Scatterplot of Difference in Votes and Unemployment", x="Unemployment", y="Difference in Votes") +
  geom_abline(intercept=coef(Reg2)[1], slope=coef(Reg2)[2], color = "blue")

## growth as independent variable and divote as dependent variable
ggplot(data, aes(x=growth, y=divote)) +
  geom_point(color = "darkslategrey") +
  labs(title = "Scatterplot of Difference in Votes and Growth", x="Growth", y="Difference in Votes") +
  geom_abline(intercept=coef(Reg3)[1], slope=coef(Reg3)[2], color = "red")

## infl as independent variable and divote as dependent variable
ggplot(data, aes(x=infl, y=divote)) +
  geom_point(color = "darkslategrey") +
  labs(title = "Scatterplot of Difference in Votes and Inflation", x="Inflation", y="Difference in Votes") +
  geom_abline(intercept=coef(Reg4)[1], slope=coef(Reg4)[2], color = "green")

# VIF Test
vif(lm(divote ~ unem + growth + infl, data= data)) # check for multicollinearity

# Durbin-Watson test
dwtest(Reg7) # check for autocorrelation

# Residual Plot for unemployment
ggplot(data, aes(x=unem, y=residuals(Reg7))) +
  geom_point(color = "darkslategrey") +
  labs(title = "Residual Plot", x="Voteshare", y="Residuals") +
  geom_abline(intercept = 0, slope = 0)

# T-test
t.test(divote,unem) # for difference in means

# Cooks Distance
RegCook1 <- lm(divote ~ unem, data = data)
D <- cooks.distance(RegCook1)

plot(D, pch=16, cex=0.5)  # plot cook's distance
abline(h = 15.3*mean(D, na.rm=T), col="red")  # add cutoff line
text(x=1:length(D)+1, y=D, labels=ifelse(D>15.3*mean(D, na.rm=T),names(D),""), col="red")  # add labels

## Drop observation (because of outliner)
s <- D<0.1
RegCook1 <- lm(divote ~ unem, data = data[s,])
stargazer(RegCook1, type="latex")

plot(data$unem[s], data$divote[s],
     xlab="Unemployment", ylab="Difference of Votes")

########################################################################################################

# Hypothesis 2a

Reg8 <- lm(divote ~ ctrright * infl, data = data)
Reg9 <- lm(divote ~ ctrleft * unem, data = data)
Reg10 <- lm(divote ~ ctrright * infl + ctrleft * unem, data = data)
stargazer(Reg8, Reg9, Reg10, covariate.labels = c(),
          dep.var.labels = c("Voteshare"), header=FALSE, type='latex')

right <- data$unem[data$ctrright == "1"]
left <- data$unem[data$ctrleft == "1"]

se.right <- sd(right) / sqrt(length(right))
se.left <- sd(left) / sqrt(length(left))

t.test(right, left)

########################################################################################################

# Hypothesis 2b

data$leftright = NA
data$leftright[data$ctrleft=="1"] = "Left incumbent party"
data$leftright[data$ctrright=="1"] = "Right incumbent party"
dataH2 = na.omit(data)
table(dataH2$leftright, dataH2$ctrleft)

# omit NAs

Reg11 <- lm(divote ~ ctrleft * infl, data = dataH2)
Reg12 <- lm(divote ~ ctrright * unem, data = dataH2)
Reg13 <- lm(divote ~ ctrleft * infl + ctrright * unem, data = dataH2)
stargazer(Reg11, Reg12, Reg13, covariate.labels = c(),
          dep.var.labels = c("Voteshare"), header=FALSE, type='latex')


Reg14 <- lm(divote ~ ctrleft * infl, data = data)
Reg15 <- lm(divote ~ ctrright * unem, data = data)
Reg16 <- lm(divote ~ ctrleft * infl + ctrright * unem, data = data)
stargazer(Reg14, Reg15, Reg16, covariate.labels = c(),
          dep.var.labels = c("Voteshare"), header=FALSE, type='latex')

m1 <- lm(divote ~ unem + ctrright, data=data)

########################################################################################################
## scatterplots with dummy variable left-right

ggplot(dataH2, aes(unem, divote, color=as.factor(leftright)))+
  geom_point()+
  scale_color_manual(values=c("green", "red"))+
  theme(legend.title = element_blank())

last_plot() +
  geom_abline(intercept = coef(m1)[1], slope=coef(m1)[2], color="red", linetype="dashed")

last_plot() +
  geom_abline(intercept = coef(m1)[1]+coef(m1)[3], slope=coef(m1)[2], color="green", linetype="dashed")
